# 7장
## 원자성
- 오류가 생겼을 때 트랜잭션을 어보트하고 해당 트랜잭션에서 기록한 모든 내용을 취소하는 능력

## 일관성
- 일관성은 애플리케이션의 속성으로 트랜잭션이 불변식이 유효한 데이터베이스에서 시작하고 트랜잭션에서 실행된 모든 쓰기가 유효성을 보존한다면 불변식이 항상 만족된다고 확신할 수 있다( 불변식 보장은 어플리케이션에서.. 그러므로 실제로는 acid에 포함되지 않음)

## 격리성
- 격리성은 동시에 실행되는 트랜잭션은 서로 격리된다는 것을 의미한다. 트랜잭션은 다른 트랜잭션을 방해할 수 없다. 고전적인 데이터베이스 교과서에서는 격리성을 직렬성이라는 용어로 공식화한다.

## 지속성
- 지속성은 트랜잭션이 성공적으로 커밋됐다면 하드웨어 결함이 발생하거나 데이터베이스가 죽더라도 트랜잭션에서 기록한 데이터는 손실되지 않는다는 보장이다.

### 트랜잭션이 없더라도 이런 애플리케이션들을 구현항 수 있다. 하지만 원자성이 없으면 오류 처리가 훨씬 더 복잡해지고 격리성이 없으면 동시성 문제가 생길 수 있다.

### 트랜잭션의 핵심 기능은 오류가 생기면 어보트되고 안전하게 재시도할 수 있다는 것이다.

### 직렬성 격리는 데이터베이스가 여러 트랜잭션들이 직렬적으로 실행되는 것과 동일한 결과가 나오도록 보장한다는 것을 의미한다.비용이 크기 때문에 완화된 트랜잭션 격리를 사용.

## 커밋 후 읽기
- 데이터베이스에서 읽을 때 커밋된 데이터만 보게된다.
- 데이터베이스에 쓸 때 커밋된 데이터만 덮어쓰게 된다.

### 커밋 후 읽기 문제점 : 비반복 읽기(계좌 송금 출금을 도시에 확인하는 경우에 타이밍 이슈로 순간적으로 총 합이 불일치하게 보일 수 있다.) -> 순간의 상황이 백업의 순간과 겹치면 영속적으로 유지 될 수 있다.

### 이런 문제를 스냅숏 격리로 해결할 수 있다. : 읽는 쪽에서 쓰는 쪽을 결코 차단하지 않고 쓰는 쪽에서 일근 쪽을 결코 차단하지 않는다. 

## 갱신 손실 방지
- 동시에 쓰기시에 발생..

- 원자적 연산과 잠근은 read - modify - write 주기가 순차적으로 실행되도록 강제함으로써 갱신 손실을 방지하는 방법이다. 대안으로 이들의 병렬 실행을 허용하고 트랜잭션 관리자가 갱신 손실을 발견하면 트랜잭션을 어보트시키고 read modify write 주기를 재시도하도록 강제하는 방법이 있다.

- compare - and - set 수정을 당하는 쪽의 내용의 변경이 없는 경우에 수행한다. 안전한지 확인이 필요하다.

### 복제가 적용된 데이터베이스에서 갱신 손실을 막는 것은 다른 차원의 문제다. 여러 노드에 데이터의 복사본이 있어서 데이터가 다른 노드들에서 동시에 변경될 수 있으므로 갱신 손실을 방지하려면 추가 단계가 필요하다. -> 동시에 실행될 때 한 값에 대해 여러 개의 충돌된 버젼을 생성하는 것을 허용하고 사후에 애플리케이션 코드나 특별한 데이터 구조를 사용해 충돌을 해소하고 이 버젼들을 병합하는 것이다.

## 쓰기 스큐
- 진짜 직렬성을 통하여 해결하자.. 일반적으로 스냅숏 격리 수준에서 자동으로 감지되지 않는다. (다시 한 번 직렬성 격리가 필요하다.)

## 팬텀
- 어떤 트랜잭션에서 실행한 쓰기가 다른 트랜잭션의 검색 질의 결과를 바꾸는 효과를 팬텀이라고 한다.

## 직렬성
### 스토어 프로시져
- 트랜잭션 코드 전체를 스토어 프로시저 형태로 데이터 베이스에 미리 제출하는 방식 -> 스토어드 프로시저가 있고 데이터가 메모리에 저장된다면 모든 트랜잭션을 단일 스레드에서 실행하는게 현실성 있다.

### 파티셔닝
- 모든 트랜잭션을 순차적으로 실행하면 동시성 제어는 훨씬 간단해지지만 데이터베이스의 트랜잭션 처리량이 단일 장비에 있는 단일 cpu 코어의 속도로 제한한다. 병목지점이 될 수 있다. 그러므로 파티셔닝을 통하여 cpu 코어 개수에 맞춰 선형적으로 확장할 수 있다. 하지만 여러 파티셔닝에 접근해야하는 트랜잭션이 있다면 데이터베이스가 해당 트랜잭션이 접근하는 모든 파티션에 걸쳐서 코디네이션을 해야한다. 직렬성을 보장하기 위해 모든 파티션에 걸쳐 잠금을 획득한 단계에서 실행돼야 한다.

## 2단계 잠금
- os에서 배웠던 쓰기가 이루어지면 락을 거는 방식-> 데드락 상태가 발생할 수 있고 이를 감지하여 어보트 시키자.

## 서술 잠금 
- 비슷하게 겹치는 조건에 대해서는 2단계 잠금만으로는 처리가 어려움 -> 하지만 시간이 오래걸림
- 그래서 색인 범위 잠금을 사용




